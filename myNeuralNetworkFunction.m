function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 09-Jun-2017 19:08:09.
% 
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timsteps
%   Each X{1,ts} = 23xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 3xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

  % ===== NEURAL NETWORK CONSTANTS =====
  
  % Input 1
  x1_step1_xoffset = [13766.7;9100;5379.17;3116.67;1066.67;404.167;616.667;183.333;91.6667;154.167;108.333;116.667;62.5;83.3333;59.1667;53.3333;29.1667;17.5;16.6667;0.833333;0;0;0];
  x1_step1_gain = [1.59714685685491e-05;2.37247924080664e-05;3.96956691826443e-05;9.44696074740575e-05;0.000183191619349798;0.000259571605617804;0.000163431632829918;0.000287424998243115;0.000505263162149585;0.000345323959629557;0.000446096289437979;0.000511727122535362;0.000837696335078534;0.000577617879029314;0.000293577839441193;0.000341442787325855;0.00136908160568355;0.00170575692963753;0.00107286738238007;0.00145366092354624;0.00305732328289259;0.00480962309388625;0.00424027968884828];
  x1_step1_ymin = -1;
  
  % Layer 1
  b1 = [-3.2200887164361136;-1.8086630885231028;1.3061631284389157;-2.5032561507414473;-2.0511490781995416;0.80596134948880582;-0.88237671965020747;-0.35624069068213055;-0.61024512549184062;-0.15854315624089443;0.34288385947561029;0.031489635601137038;1.3498560321124624;-0.60362708943739785;1.348140081841195;-0.25390773649870263;-0.094393067957548274;0.95852804678024939;0.25825975632151477;2.1502551722040306;0.92631354852571257;-1.1288083176511654;1.7823267071418738];
  IW1_1 = [1.8201695634964856 1.541393343379472 -0.7067510837229144 -0.64116263062509193 -1.7465463781983965 0.20303401245242003 1.6085701063382569 1.556599033023961 -1.9535835644151636 -1.5229595896909611 -1.3450523539625232 0.24433681357541159 1.5499893845520676 -0.80489441425524244 0.5308931120081819 -0.40187814190666166 0.64989429855794945 3.1086485016257654 0.0043930915628559346 1.1581578827952042 0.69679443937135943 -0.96466846909671167 -0.55615683261724036;-1.2455322049469046 -0.4202629491567903 0.26182444636358693 1.5596484852524615 0.023513729212610246 -2.3172406650624051 -1.2165610857700833 0.31340124948253739 -0.67221778947933353 -0.87134122501431588 -0.46578720267705781 -0.029016578507809657 0.86816319479756432 -1.0593571099524199 -0.37887435180438611 1.2383316259524879 -0.26686413594508784 1.07459555384726 1.5694919095641893 -0.28248299259765902 0.37594251040865873 -0.013792163422818601 1.0731725589658632;-0.6616519561830857 0.72730808517159751 1.7637859617126439 -0.078234915053761414 -0.36495391256997051 1.9624944845092398 0.3545729097378304 0.62564690919475718 0.21407588696584051 0.67495380343974254 -0.89606631642775358 0.15676825903890046 0.043815310221479296 0.47543654323258977 -1.5241686921901818 2.4862206301397065 0.84168967770720005 -1.3838403581781162 -1.3173116286551074 1.9884226341682594 -1.2676270529813838 -0.19279000363147439 -2.3112620841609304;1.2605178441996672 -0.60229849653507106 -1.0025199699913734 1.1801145269242805 -1.3594823083011642 -1.8015394364256305 -0.87069562345937779 -0.4656928305225595 0.45610389642028792 -0.58415268103648399 -0.14522378330526695 0.36572199953858719 0.14427318318146878 -0.36356122045425199 0.92692660650303327 0.33178451921080748 -0.42600727788193216 -0.22456965766302486 -0.10238680708727881 0.068883372592508693 -0.59812953843996441 -0.50896550075557179 -0.1411884496708361;-0.38844569786942074 0.2786660736181803 0.019189118569928956 -0.28551213162800076 -0.10324127642242807 0.4008758844762455 -0.63544204622040446 1.2836677192370283 -0.52916931012094881 -0.033480555303860404 -0.13259679733030152 -0.2598930988248796 -0.067395412905471949 -0.56244466768777179 -1.799652067208078 0.3291901487417106 1.646522481936878 -1.7113632588385197 -1.353919857984234 -0.68934767796979901 -1.0344567392806117 -0.64062078572439662 0.49098227592389232;-1.1561035548668188 0.41167980584764019 -0.7572534506627866 0.93705255645055263 -0.30374609492819976 -0.39990891745792817 0.51526151445566259 0.774124760521958 -0.2995260644963999 -1.5887145583421876 -0.71430561096865841 -0.39679300830254133 0.061314200506285631 -1.176996969433421 0.42930585175122687 -0.26521848629547856 -0.088445091729796144 -0.18057734628370123 0.76153327830872752 1.9718879552103135 0.82239334609342374 1.0877352766715545 -0.18183718600836379;0.0087354513463385967 -0.8554403361982853 0.65797877823092066 0.43829783522233434 -0.72314866610743866 0.060340490916387025 0.93347378131419267 0.31716129491198347 -0.34412368651673081 -0.066699691752427875 -0.49275343365249247 0.75076130345835546 -0.43130624033691645 -0.024356387466189459 -1.0198675353273445 0.82744796531537901 0.1750731993188131 -1.1787741509200507 0.66389256165577504 0.33974593029233707 0.53121704586695617 -0.48133294323327314 -1.0118681603354338;-0.59474635386251196 1.0701583613297223 -0.73198177070189252 -0.54370940626878372 -0.035185723787394499 -1.2299689418594135 -1.9255993450959223 0.3874013830314964 0.24001732090469222 0.34308105510722164 0.29906934593488982 -0.18025777956338809 0.29755311537286155 0.84203458726217018 0.47775592850129445 0.41776420042123585 -1.4295566536132511 0.27386082685956936 -0.99675777254852305 -0.10381752374051537 0.90194086097221993 1.4601417406690882 -0.046453695887794487;0.55522074936621957 -0.49243162098787341 -0.8698590951885351 0.4041113068871196 -0.90696503895122027 -0.58867850028463053 0.56324311090303913 -0.46637042271847401 -0.85101650442682419 -0.61127222275745641 0.2551765037926399 0.66707077326075592 1.0787534933808129 0.10640157617086494 0.1837373944540511 0.19650579351441985 0.30096995861029691 -0.47544950213613163 -1.7317634036856977 0.75419235959087305 -1.1623239239075698 -0.065359057922227654 -0.43404182459763957;0.84425576463202823 -2.0801251004748584 0.15239989842211674 1.7291545879599493 0.71221110711498481 -1.8781912344168235 -2.5346316918805822 -0.54397437068453913 0.6050774116541866 0.08508948609265525 1.619142428188209 1.1793595539740802 -0.54349480715113296 -0.2847545137991927 1.1862827228942738 1.3147186850893358 -2.2020381528044464 1.1408921632651379 -0.020879791763467277 1.0567153742801791 1.569826505250836 0.73929684501337767 -0.1275891358883906;-0.756462817354696 1.2470367487912097 0.84607942916190759 -1.7780003982957622 -0.28851910123350594 0.3542802600162071 0.92095831934240202 0.11259369112517721 -0.023080173899781939 0.096929131553650044 -0.19689135404581221 -0.6845040320501492 0.63573893301803952 -0.21228491943077524 -1.4231414689552544 0.021374443883025313 1.4960419635121367 -1.4135830775188689 0.0042802420165426961 -0.71564083476032303 -1.2857262526761188 -0.30362857881665667 -0.32179063826871462;0.025958545163364721 -0.16397552994603184 0.1159789298329882 0.067365366176296307 -0.12270825491680556 0.054519687966494028 0.14924968199069541 0.020992941176799725 -0.049364221904009666 -0.057536158335185536 -0.11338537939844842 0.098617955242766453 -0.033726804363242185 0.082807230662868728 0.13887065163011095 0.34378978242076624 0.047729687516325857 -0.05506072989353851 0.1200920721041686 0.035582793402332592 -0.0032763650352848703 -0.083864600610768419 -0.31906720913339864;1.1401923159110712 -0.2517986836008686 0.95931492817740815 -0.97508346183194472 -0.16734029922079796 -1.5214163008342299 -0.21800688126619394 -0.62924604639025927 1.1521083655811806 -0.37866169844706027 1.1027223237294841 0.15820723150700447 -0.69171279369204408 0.37133768858060562 -0.53885416083754922 -0.23881623594367923 0.93398906306272267 -1.0158263275231239 0.99273151284398753 -1.3774959151658348 -0.095296702283723694 -0.1152979289808682 -1.199803951905736;0.57049397660674483 -0.39928810180312252 0.017116685093935428 1.1526995317065951 -0.6892864886114608 -1.3278015966472823 -0.86325899813480156 -0.57837045512629748 0.97182630719738139 -0.015217385292083932 -0.1188978942467291 -0.12003289572943811 0.3729726891140086 0.093985779019251994 0.29709305744480258 0.083206058701160712 0.44890443269489583 -0.018022704738217162 0.38119298713049293 -0.42196873364993326 -0.82457939432593663 -0.11203475818491872 -0.69444560606980443;0.74733600427879143 0.14433979262459157 0.29463666876318739 -1.4546008777127024 0.7698076166787533 1.0165345458544821 0.17737227245539114 -0.74397754525045523 0.48768108760466106 1.2978508189277773 0.76659767919758526 -0.28356860371588666 -0.47757526318380999 1.1608975696471597 0.30562210445818755 -0.20795978493261924 0.77440387627462504 -0.18694826794146924 -0.97600714398026123 -1.2128029034555388 -0.11424756141144966 -0.26758933475881008 -0.26930716525309489;0.16419082935495929 0.69353591778634982 -0.24829965761823455 0.61410123995573529 0.38552658765995379 -0.84731540526456661 0.50902738133832415 1.0678374075064911 0.37657453543220426 -0.19437138389343253 0.20872005942879218 0.022310708709287107 0.55159735264757226 0.19702892113132675 -1.5600252499973146 -1.5706030926179155 -0.47897493851420758 0.26606053156976084 0.26292814681704979 -0.11749868150499493 0.57060578268517381 0.10274092724708327 0.1655390961843618;0.034485108186492953 0.43414772573091603 -0.39089275248911504 -0.1339492292140588 0.16754895398115699 0.15997949008716991 -0.26609985000332131 0.17033769262030801 0.1096376377002392 0.076598978561703182 0.34546532099550664 -0.034537808314209377 0.027717745166267585 0.15437822959560138 0.41135623440870378 0.51514662183781701 0.74919190473365205 -0.51062208429448963 -0.41215320909141306 -0.32421936801327117 0.090082462490326864 -0.11129269906592887 0.076968090890660923;-0.081724963274759713 0.1569013973612379 -0.0782549935041158 -0.046580088972494424 0.094405608460401261 0.10289395825856447 -0.070898723878157072 -0.07078204273385072 0.012009891433428904 -0.13894452444817312 -0.035249368466763097 -0.1379930752381649 0.10797658197137421 0.057403722977358934 0.32587684394863237 0.0043679222690611039 -0.049636508095275915 0.38854225700114314 0.010352996268542759 0.074856793421698917 0.029390478645188692 0.18514218700748755 0.13097283906655868;1.2670713025038987 -0.49098115073921011 -0.36009790672712172 0.17796956699313579 0.03449472521982163 -1.0639795915350778 -0.72562259442804578 -0.49995859157567341 0.56118548349189668 0.77280180658344821 0.47268560187249375 -0.17409277841677318 0.099532835511821252 0.055800854996496514 1.1773401861895474 -0.23307904426212331 -0.14008511221122932 0.44048838912928795 0.05685186197802633 -0.14912694519204928 -0.96557346798730981 -0.14716656029697453 0.55858134189873121;1.270083468823364 0.62074286945243617 0.97028211066325365 0.19725541962916679 -0.17777871776084428 0.29183404046463557 0.56004295743907906 -0.37686701391549615 0.17291505569097762 0.18417464932056646 -0.4003163999142893 0.39047161949642833 -1.0805781473219054 -0.74896188639273731 0.46429406094066311 -0.7849553473504971 -0.097464148253614255 -0.077348832543337756 0.47016054259912704 -0.40834467360977872 0.034519345237956786 0.8313449081441685 0.15119552816394896;-0.83379676899848809 0.65250487995501183 -0.23418042960214283 -0.22277435413372296 -0.92104797161530516 0.53645427134821999 -0.27507701985712091 -2.0802387835723248 0.38617067104031905 -0.66554863283717491 0.54858692038554213 0.80003469445781883 1.5270763768556217 -0.35897336495104132 -0.23867849668058283 -1.8815609574396335 -0.041388384873646933 0.02494743031618122 -0.69357396524198733 -0.10523476130501534 -0.078239048729031174 -0.68747979290878192 1.0713032097382573;-2.1748247621371966 0.11208835292764972 1.5099961330951124 -0.70908714381439886 0.018268128286984021 1.7254889309484132 -0.029581876553617256 0.5562558059771231 -0.27553711804202097 0.39568202374833705 -0.83456962831739911 -0.31898498986865753 1.0071157446910886 -0.82763751106731043 -0.1847910983095411 0.78321910783706095 -0.64871818530436587 0.44012104097087773 -0.64882023221394292 1.0166704057278531 0.052410979725856517 0.77676881234905748 0.91402894625508202;-0.7177710720917827 0.057175741161459202 0.25996838586277216 0.13163351393930811 0.23157962580951261 -0.00027055475683890177 -0.71449965401868276 1.1507494950851023 -0.44892213967439204 -0.54462485353468248 1.037783378633248 0.69567242434470522 0.69722270462663427 -0.54739078542418396 0.047105991369963456 1.3281770719736818 0.041897573361487771 -0.29106966837576431 -0.26102962402232371 -1.0257036219256432 -1.0311859201664644 -0.36350444010070043 2.2083820852998333];
  
  % Layer 2
  b2 = [-0.88744342203937587;-0.39587533164434624;0.11786289289158917];
  LW2_1 = [-0.57439111725501812 0.073861913269012688 0.015219561631870172 -0.025759247855016095 -0.049490234419345337 0.051721759286044479 0.46373022796566277 0.024782628606666468 0.075705781069872358 -0.47360071602658044 -0.77001501585157672 -1.2308138146901304 1.3311634888364683 -0.031069954913654118 0.084019202580474461 -0.016595890595769304 0.18540068437565124 1.3069544274009208 0.16058368128354567 -0.0028437266837962449 -0.4050024814170905 1.3360684646773511 0.038708589961926804;-0.16642232396423509 0.085768214964042591 0.006706612674892436 0.0049395257233983275 -0.004056567243177012 0.026747249096339881 0.11981536631428286 0.010618618607337404 0.017833523168161187 -0.10958659626570545 -0.18865050121211613 0.52382845913603238 0.3902056172454319 -0.056674145582851068 0.071571642954261008 0.032452753061813264 0.20007596209305759 0.59797695068192003 0.1481338439708407 -0.0011566697876257438 -0.10195729846487399 0.4796372238777028 0.049928708721470982;-0.061015567663374411 0.17808160738175549 0.072613342161671021 0.20612521786319149 0.10688546209668749 -0.051740142471012995 0.35828401054172976 -0.10359265534904162 0.11150488058637609 0.28121122820824007 0.37419286013480119 0.33995938196650449 -0.070650283125076291 -0.53127544061838694 0.032873403245407218 0.4391660621566838 0.13582925490833919 0.64552842839816427 0.67683782437285511 -0.020516230216323553 0.095514911104312164 0.26211563118866965 -0.021916493018446146];
  
  % Output 1
  y1_step1_ymin = -1;
  y1_step1_gain = [0.00095128018530938;0.0104357080291346;0.123013864277573];
  y1_step1_xoffset = [23.7;6.68333;2.59167];
  
  % ===== SIMULATION ========
  
  % Format Input Arguments
  isCellX = iscell(X);
  if ~isCellX, X = {X}; end;
  
  % Dimensions
  TS = size(X,2); % timesteps
  if ~isempty(X)
    Q = size(X{1},2); % samples/series
  else
    Q = 0;
  end
  
  % Allocate Outputs
  Y = cell(1,TS);
  
  % Time loop
  for ts=1:TS
  
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1_gain,y1_step1_xoffset,y1_step1_ymin);
  end
  
  % Final Delay States
  Xf = cell(1,0);
  Af = cell(2,0);
  
  % Format Output Arguments
  if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
  y = bsxfun(@minus,x,settings_xoffset);
  y = bsxfun(@times,y,settings_gain);
  y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings_gain,settings_xoffset,settings_ymin)
  x = bsxfun(@minus,y,settings_ymin);
  x = bsxfun(@rdivide,x,settings_gain);
  x = bsxfun(@plus,x,settings_xoffset);
end
